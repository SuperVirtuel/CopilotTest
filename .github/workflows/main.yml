name: Pipeline Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      # Cache Blender
      - name: Cache Blender
        id: cache-blender
        uses: actions/cache@v3
        with:
          path: /usr/local/blender
          key: blender-4.3.0
      
      # Download and install Blender
      - name: Install Blender
        if: steps.cache-blender.outputs.cache-hit != 'true'
        run: |
          wget -q https://download.blender.org/release/Blender4.3/blender-4.3.0-linux-x64.tar.xz
          tar -xf blender-4.3.0-linux-x64.tar.xz
          sudo mv blender-4.3.0-linux-x64 /usr/local/blender
      
      - name: Add Blender to PATH
        run: |
          sudo ln -sf /usr/local/blender/blender /usr/local/bin/blender
          blender --version
      
      - name: Install pytest-blender
        run: pip install pytest-blender pytest
      
      - name: Run tests
        run: pytest tests/ -v
